%Численный метод решения волновой задачи.
%Дифференциальное уравнение: u_tt = c^2*u_xx
%Граничные условия: u(0,t) = u(1,t) = 0
%Начальное условие: u(x,0) = sin(2*pi*x), u_t(x,0) = 0
%Решение: u(x,t) = sin(2*pi*x)*cos(2*pi*t)

%Параметры сетки
N = 1000; %Число узлов
h = 1/(N-1); %Шаг по пространству
T = 2; %Время расчета
l = 1; %Длина отрезка
%Из условия устойчивости: tau <= h
tau = h; %Шаг по времени
M = ceil(T/tau); %Число шагов по времени
x = linspace(0, l, N); %Вектор координат
t = linspace(0, T, M); %Вектор времени

%Параметры задачи
c = 1; %Скорость распространения волны
a = c^2*tau^2/h^2; %Параметр схемы

%Инициализация массивов
u = zeros(N,M); %Массив решения
u(:,1) = sin(2*pi*x); %Начальное условие
u_t_0 = zeros(N,1); %Начальное условие для первого слоя
u(1,:) = 0; %Граничное условие
u(N,:) = 0; %Граничное условие

%Численное решение
%Цикл по времени
for n = 1:M-1
    if n == 1 %Расчет второго слоя
        u(2:N-1,2) = u(2:N-1,1) + a/2*(u(3:N,1) - 2*u(2:N-1,1) + u(1:N-2,1)) + tau*u_t_0(2:N-1);
    else %Расчет остальных слоев
        u(2:N-1,n+1) = 2*u(2:N-1,n) - u(2:N-1,n-1) + a*(u(3:N,n) - 2*u(2:N-1,n) + u(1:N-2,n));
    end
end

%Аналитическое решение
u_an = sin(2*pi*x)'*cos(2*pi*t);

%Построение графиков
figure(1)
mesh(x,t,u')
title('Numerical solution')
xlabel('x')
ylabel('t')
zlabel('u(x,t)')
figure(2)
mesh(x,t,u_an')
title('Analytical solution')
xlabel('x')
ylabel('t')
zlabel('u(x,t)')

%Вывод ошибки
err = max(max(abs(u-u_an)));
disp(['Error = ',num2str(err)])
